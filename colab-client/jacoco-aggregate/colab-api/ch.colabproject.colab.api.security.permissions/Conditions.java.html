<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Conditions.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">colab-client</a> &gt; <a href="../index.html" class="el_bundle">colab-api</a> &gt; <a href="index.source.html" class="el_package">ch.colabproject.colab.api.security.permissions</a> &gt; <span class="el_source">Conditions.java</span></div><h1>Conditions.java</h1><pre class="source lang-java linenums">/*
 * The coLAB project
 * Copyright (C) 2021 AlbaSim, MEI, HEIG-VD, HES-SO
 *
 * Licensed under the MIT License
 */
package ch.colabproject.colab.api.security.permissions;

import ch.colabproject.colab.api.controller.RequestManager;
import ch.colabproject.colab.api.controller.security.SecurityManager;
import ch.colabproject.colab.api.model.card.Card;
import ch.colabproject.colab.api.model.card.CardContent;
import ch.colabproject.colab.api.model.project.Project;
import ch.colabproject.colab.api.model.user.User;
import java.util.List;
import java.util.Objects;
import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * Utility class to build conditions
 *
 * @author maxence
 */
public final class Conditions {

    /** logger */
<span class="nc" id="L30">    private static final Logger logger = LoggerFactory.getLogger(Conditions.class);</span>

    /**
     * An always true condition
     */
<span class="nc" id="L35">    public static final Condition alwaysTrue = new AlwaysTrue();</span>

    /**
     * A always false condition
     */
<span class="nc" id="L40">    public static final Condition alwaysFalse = new AlwaysFalse();</span>

    /**
     * By default if the situation cannot happen
     */
<span class="nc" id="L45">    public static final Condition defaultForOrphan = alwaysTrue;</span>

    /**
     * Is the current authenticated condition
     */
<span class="nc" id="L50">    public static final Condition authenticated = new IsAuthenticated();</span>

    /**
     * Private constructor prevents instantiation
     */
<span class="nc" id="L55">    private Conditions() {</span>
<span class="nc" id="L56">        throw new UnsupportedOperationException(&quot;This is a utility class&quot;);</span>
    }

    /**
     * Abstract condition. To rule them all
     */
<span class="nc" id="L62">    public static abstract class Condition {</span>

        /**
         * Evaluate the condition
         *
         * @param requestManager  the request Manager
         * @param securityManager the security manager
         *
         * @return evaluation result
         */
        public boolean eval(RequestManager requestManager, SecurityManager securityManager) {
<span class="nc" id="L73">            Boolean cachedResult = requestManager.getConditionResult(this);</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">            if (cachedResult != null) {</span>
<span class="nc" id="L75">                logger.trace(&quot;Condition {} is cached and {}&quot;, this, cachedResult);</span>
<span class="nc" id="L76">                return cachedResult;</span>
            } else {
<span class="nc" id="L78">                boolean result = this.internalEval(requestManager, securityManager);</span>
<span class="nc" id="L79">                logger.trace(&quot;Condition {} is not cached and {}&quot;, this, result);</span>
<span class="nc" id="L80">                requestManager.registerConditionResult(this, result);</span>
<span class="nc" id="L81">                return result;</span>
            }
        }

        /**
         * Evaluate the condition
         *
         * @param requestManager  the request Manager
         * @param securityManager the security manager
         *
         * @return evaluation result
         */
        protected abstract boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager);
    }

    /**
     * Always true statement
     */
    private static class AlwaysTrue extends Condition {

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L105">            return true;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L110">            return &quot;true&quot;;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc" id="L115">            return obj instanceof AlwaysTrue;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L120">            int hash = 7;</span>
<span class="nc" id="L121">            hash = 31 * hash + Objects.hashCode(true);</span>
<span class="nc" id="L122">            return hash;</span>
        }
    }

    /**
     * Always false statement
     */
    private static class AlwaysFalse extends Condition {

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L134">            return false;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L139">            return &quot;false&quot;;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc" id="L144">            return obj instanceof AlwaysFalse;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L149">            int hash = 7;</span>
<span class="nc" id="L150">            hash = 31 * hash + Objects.hashCode(true);</span>
<span class="nc" id="L151">            return hash;</span>
        }

    }

    /**
     * AND condition
     */
    public static class And extends Condition {

        /** Sub conditions */
        private Condition[] conditions;

        /**
         * Build an AND statement
         *
         * @param conditions list of all conditions that should be true
         */
<span class="nc" id="L169">        public And(Condition... conditions) {</span>
<span class="nc" id="L170">            this.conditions = conditions;</span>
<span class="nc" id="L171">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc bnc" id="L176" title="All 2 branches missed.">            for (Condition c : conditions) {</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">                if (!c.eval(requestManager, securityManager)) {</span>
                    // not all conditions are true =&gt; false
<span class="nc" id="L179">                    return false;</span>
                }
            }
            // no falsy condition found =&gt; true
<span class="nc" id="L183">            return true;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L188">            return &quot;And(&quot; + List.of(conditions) + ')';</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L193">            int hash = 3;</span>
<span class="nc" id="L194">            hash = 31 * hash + new HashCodeBuilder().append(this.conditions).toHashCode();</span>
<span class="nc" id="L195">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L200" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L201">                return true;</span>
            }
<span class="nc bnc" id="L203" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L204">                return false;</span>
            }
<span class="nc bnc" id="L206" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L207">                return false;</span>
            }
<span class="nc" id="L209">            final And other = (And) obj;</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">            if (!Objects.equals(this.conditions, other.conditions)) {</span>
<span class="nc" id="L211">                return false;</span>
            }
<span class="nc" id="L213">            return true;</span>
        }
    }

    /**
     * OR condition
     */
    public static class Or extends Condition {

        /** Sub conditions */
        private Condition[] conditions;

        /**
         * Build an OR statement
         *
         * @param conditions list of all conditions that should be true
         */
<span class="nc" id="L230">        public Or(Condition... conditions) {</span>
<span class="nc" id="L231">            this.conditions = conditions;</span>
<span class="nc" id="L232">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc bnc" id="L237" title="All 2 branches missed.">            for (Condition c : conditions) {</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">                if (c.eval(requestManager, securityManager)) {</span>
                    // at least on sub condition is true =&gt; true
<span class="nc" id="L240">                    return true;</span>
                }
            }
            // no true condition found =&gt; false
<span class="nc" id="L244">            return false;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L249">            return &quot;Or(&quot; + List.of(conditions) + ')';</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L254">            int hash = 3;</span>
<span class="nc" id="L255">            hash = 59 * hash + new HashCodeBuilder().append(this.conditions).toHashCode();</span>
<span class="nc" id="L256">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L261" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L262">                return true;</span>
            }
<span class="nc bnc" id="L264" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L265">                return false;</span>
            }
<span class="nc bnc" id="L267" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L268">                return false;</span>
            }
<span class="nc" id="L270">            final Or other = (Or) obj;</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">            if (!new EqualsBuilder().append(this.conditions, other.conditions).isEquals()) {</span>
<span class="nc" id="L272">                return false;</span>
            } else {
<span class="nc" id="L274">                return true;</span>
            }
        }
    }

    /**
     * NOT
     */
    public static class Not extends Condition {

        /** the condition to negate */
        private final Condition condition;

        /**
         * Build a NOT statement
         *
         * @param condition the condition to negate
         */
<span class="nc" id="L292">        public Not(Condition condition) {</span>
<span class="nc" id="L293">            this.condition = condition;</span>
<span class="nc" id="L294">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
            // just invert the given sub-conditions
<span class="nc bnc" id="L300" title="All 2 branches missed.">            return !condition.eval(requestManager, securityManager);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L305">            return &quot;Not(&quot; + condition + ')';</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L310">            int hash = 5;</span>
<span class="nc" id="L311">            hash = 37 * hash + Objects.hashCode(this.condition);</span>
<span class="nc" id="L312">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L317" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L318">                return true;</span>
            }
<span class="nc bnc" id="L320" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L321">                return false;</span>
            }
<span class="nc bnc" id="L323" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L324">                return false;</span>
            }
<span class="nc" id="L326">            final Not other = (Not) obj;</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">            if (!Objects.equals(this.condition, other.condition)) {</span>
<span class="nc" id="L328">                return false;</span>
            }
<span class="nc" id="L330">            return true;</span>
        }
    }

    /**
     * Is the current user the given one ?
     */
    public static class IsCurrentUserThisUser extends Condition {

        /** user to check against */
        private final User user;

        /**
         * Check who the current user is
         *
         * @param user user to check currentUser against
         */
<span class="nc" id="L347">        public IsCurrentUserThisUser(User user) {</span>
<span class="nc" id="L348">            this.user = user;</span>
<span class="nc" id="L349">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L354">            User currentUser = requestManager.getCurrentUser();</span>
<span class="nc bnc" id="L355" title="All 4 branches missed.">            return currentUser != null &amp;&amp; currentUser.equals(user);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L360">            return &quot;IsUser(&quot; + user + &quot;)&quot;;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L365">            int hash = 5;</span>
<span class="nc" id="L366">            hash = 73 * hash + Objects.hashCode(this.user);</span>
<span class="nc" id="L367">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L372" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L373">                return true;</span>
            }
<span class="nc bnc" id="L375" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L376">                return false;</span>
            }
<span class="nc bnc" id="L378" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L379">                return false;</span>
            }
<span class="nc" id="L381">            final IsCurrentUserThisUser other = (IsCurrentUserThisUser) obj;</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">            if (!Objects.equals(this.user, other.user)) {</span>
<span class="nc" id="L383">                return false;</span>
            }
<span class="nc" id="L385">            return true;</span>
        }
    }

    /**
     * The current user must be member of the given project team
     */
    public static class IsCurrentUserMemberOfProject extends Condition {

        /** the project */
        private final Project project;

        /**
         * Create a &quot;Is current user member of this project&quot; statement
         *
         * @param project the project to check if the current user is member of
         */
<span class="nc" id="L402">        public IsCurrentUserMemberOfProject(Project project) {</span>
<span class="nc" id="L403">            this.project = project;</span>
<span class="nc" id="L404">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L409">            return securityManager.isCurrentUserMemberOfTheProjectTeam(project);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L414">            return &quot;IsMemberOf(&quot; + project + &quot;)&quot;;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L419">            int hash = 7;</span>
<span class="nc" id="L420">            hash = 37 * hash + Objects.hashCode(this.project);</span>
<span class="nc" id="L421">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L426" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L427">                return true;</span>
            }
<span class="nc bnc" id="L429" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L430">                return false;</span>
            }
<span class="nc bnc" id="L432" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L433">                return false;</span>
            }
<span class="nc" id="L435">            final IsCurrentUserMemberOfProject other = (IsCurrentUserMemberOfProject) obj;</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">            if (!Objects.equals(this.project, other.project)) {</span>
<span class="nc" id="L437">                return false;</span>
            }
<span class="nc" id="L439">            return true;</span>
        }
    }

    /**
     * The current user must be owner of the given project team
     */
    public static class IsCurrentUserOwnerOfProject extends Condition {

        /** the project */
        private final Project project;

        /**
         * Create a &quot;Is current user owner of this project&quot; statement
         *
         * @param project the project to check if the current user is member of
         */
<span class="nc" id="L456">        public IsCurrentUserOwnerOfProject(Project project) {</span>
<span class="nc" id="L457">            this.project = project;</span>
<span class="nc" id="L458">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L463">            return securityManager.isCurrentUserOwnerOfTheProject(project);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L468">            return &quot;IsOwnerOf(&quot; + project + &quot;)&quot;;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L473">            int hash = 3;</span>
<span class="nc" id="L474">            hash = 23 * hash + Objects.hashCode(this.project);</span>
<span class="nc" id="L475">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L480" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L481">                return true;</span>
            }
<span class="nc bnc" id="L483" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L484">                return false;</span>
            }
<span class="nc bnc" id="L486" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L487">                return false;</span>
            }
<span class="nc" id="L489">            final IsCurrentUserOwnerOfProject other = (IsCurrentUserOwnerOfProject) obj;</span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">            if (!Objects.equals(this.project, other.project)) {</span>
<span class="nc" id="L491">                return false;</span>
            }
<span class="nc" id="L493">            return true;</span>
        }
    }

    /**
     * The current user must be leader of the given project team
     */
    public static class IsCurrentUserLeaderOfProject extends Condition {

        /** the project */
        private final Project project;

        /**
         * Create a &quot;Is current user leader of this project&quot; statement
         *
         * @param project the project to check if the current user is member of
         */
<span class="nc" id="L510">        public IsCurrentUserLeaderOfProject(Project project) {</span>
<span class="nc" id="L511">            this.project = project;</span>
<span class="nc" id="L512">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L517">            return securityManager.isCurrentUserLeaderOfTheProject(project);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L522">            return &quot;IsLeaderOf(&quot; + project + &quot;)&quot;;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L527">            int hash = 3;</span>
<span class="nc" id="L528">            hash = 83 * hash + Objects.hashCode(this.project);</span>
<span class="nc" id="L529">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L534" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L535">                return true;</span>
            }
<span class="nc bnc" id="L537" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L538">                return false;</span>
            }
<span class="nc bnc" id="L540" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L541">                return false;</span>
            }
<span class="nc" id="L543">            final IsCurrentUserLeaderOfProject other = (IsCurrentUserLeaderOfProject) obj;</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">            if (!Objects.equals(this.project, other.project)) {</span>
<span class="nc" id="L545">                return false;</span>
            }
<span class="nc" id="L547">            return true;</span>
        }
    }

    /**
     * The current user must be, at least, internal to given project team
     */
    public static class IsCurrentUserInternalToProject extends Condition {

        /** the project */
        private final Project project;

        /**
         * Create a &quot;Is current user internal to this project&quot; statement
         *
         * @param project the project to check if the current user is member of
         */
<span class="nc" id="L564">        public IsCurrentUserInternalToProject(Project project) {</span>
<span class="nc" id="L565">            this.project = project;</span>
<span class="nc" id="L566">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L571">            return securityManager.isCurrentUserInternalToProject(project);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L576">            return &quot;IsInternalTo(&quot; + project + &quot;)&quot;;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L581">            int hash = 7;</span>
<span class="nc" id="L582">            hash = 67 * hash + Objects.hashCode(this.project);</span>
<span class="nc" id="L583">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L588" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L589">                return true;</span>
            }
<span class="nc bnc" id="L591" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L592">                return false;</span>
            }
<span class="nc bnc" id="L594" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L595">                return false;</span>
            }
<span class="nc" id="L597">            final IsCurrentUserInternalToProject other = (IsCurrentUserInternalToProject) obj;</span>
<span class="nc bnc" id="L598" title="All 2 branches missed.">            if (!Objects.equals(this.project, other.project)) {</span>
<span class="nc" id="L599">                return false;</span>
            }
<span class="nc" id="L601">            return true;</span>
        }
    }

    /**
     * Are current and given users teammate ?
     */
    public static class IsCurrentUserTeamMateOfUser extends Condition {

        /** the other user */
        private final User user;

        /**
         * Create a are teammate statement
         *
         * @param user the user to check against
         */
<span class="nc" id="L618">        public IsCurrentUserTeamMateOfUser(User user) {</span>
<span class="nc" id="L619">            this.user = user;</span>
<span class="nc" id="L620">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L625">            User currentUser = requestManager.getCurrentUser();</span>
<span class="nc bnc" id="L626" title="All 4 branches missed.">            return currentUser != null &amp;&amp; securityManager.areUserTeammate(currentUser, this.user);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L631">            return &quot;IsTeamMateOf(&quot; + user + &quot;)&quot;;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L636">            int hash = 3;</span>
<span class="nc" id="L637">            hash = 31 * hash + Objects.hashCode(this.user);</span>
<span class="nc" id="L638">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L643" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L644">                return true;</span>
            }
<span class="nc bnc" id="L646" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L647">                return false;</span>
            }
<span class="nc bnc" id="L649" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L650">                return false;</span>
            }
<span class="nc" id="L652">            final IsCurrentUserTeamMateOfUser other = (IsCurrentUserTeamMateOfUser) obj;</span>
<span class="nc bnc" id="L653" title="All 2 branches missed.">            if (!Objects.equals(this.user, other.user)) {</span>
<span class="nc" id="L654">                return false;</span>
            }
<span class="nc" id="L656">            return true;</span>
        }
    }

    /**
     * Do current and given user work on a common project ?
     */
    public static class DoCurrentUserWorkOnSameProjectThanUser extends Condition {

        /** the other user */
        private final User user;

        /**
         * Create a are teammate statement
         *
         * @param user the user to check against
         */
<span class="nc" id="L673">        public DoCurrentUserWorkOnSameProjectThanUser(User user) {</span>
<span class="nc" id="L674">            this.user = user;</span>
<span class="nc" id="L675">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L680">            User currentUser = requestManager.getCurrentUser();</span>
<span class="nc bnc" id="L681" title="All 2 branches missed.">            return currentUser != null</span>
<span class="nc bnc" id="L682" title="All 2 branches missed.">                &amp;&amp; securityManager.doUsersHaveCommonProject(currentUser, this.user);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L687">            return &quot;DoCurrentUserWorkOnSameProjectThanUser(&quot; + user + &quot;)&quot;;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L692">            int hash = 3;</span>
<span class="nc" id="L693">            hash = 31 * hash + Objects.hashCode(this.user);</span>
<span class="nc" id="L694">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L699" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L700">                return true;</span>
            }
<span class="nc bnc" id="L702" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L703">                return false;</span>
            }
<span class="nc bnc" id="L705" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L706">                return false;</span>
            }
<span class="nc" id="L708">            final DoCurrentUserWorkOnSameProjectThanUser other = (DoCurrentUserWorkOnSameProjectThanUser) obj;</span>
<span class="nc bnc" id="L709" title="All 2 branches missed.">            if (!Objects.equals(this.user, other.user)) {</span>
<span class="nc" id="L710">                return false;</span>
            }
<span class="nc" id="L712">            return true;</span>
        }
    }

    /**
     * Is the current user authenticated ?
     */
    private static class IsAuthenticated extends Condition {

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L724">            return requestManager.isAuthenticated();</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L729">            return &quot;IsAuthenticated&quot;;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc" id="L734">            return obj instanceof IsAuthenticated;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L739">            int hash = 7;</span>
<span class="nc" id="L740">            hash = 83 * hash;</span>
<span class="nc" id="L741">            return hash;</span>
        }
    }

    /**
     * Has the current user write access to a card ?
     */
    public static class HasCardWriteRight extends Condition {

        /** The card * */
        private final Card card;

        /**
         * Create a has write access statement
         *
         * @param card the card
         */
<span class="nc" id="L758">        public HasCardWriteRight(Card card) {</span>
<span class="nc" id="L759">            this.card = card;</span>
<span class="nc" id="L760">        }</span>

        /**
         * Create a has write access statement
         *
         * @param cardContent a card content
         */
<span class="nc" id="L767">        public HasCardWriteRight(CardContent cardContent) {</span>
<span class="nc" id="L768">            this.card = cardContent.getCard();</span>
<span class="nc" id="L769">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L774">            return securityManager.hasReadWriteAccess(card);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L779">            return &quot;HasCardWriteRight(&quot; + card + &quot;)&quot;;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L784">            int hash = 7;</span>
<span class="nc" id="L785">            hash = 47 * hash + Objects.hashCode(this.card);</span>
<span class="nc" id="L786">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L791" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L792">                return true;</span>
            }
<span class="nc bnc" id="L794" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L795">                return false;</span>
            }
<span class="nc bnc" id="L797" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L798">                return false;</span>
            }
<span class="nc" id="L800">            final HasCardWriteRight other = (HasCardWriteRight) obj;</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">            if (!Objects.equals(this.card, other.card)) {</span>
<span class="nc" id="L802">                return false;</span>
            }
<span class="nc" id="L804">            return true;</span>
        }
    }

    /**
     * Has the current user access to a card ?
     */
    public static class HasCardReadRight extends Condition {

        /** The card * */
        private final Card card;

        /**
         * Create a has read access statement
         *
         * @param card the card
         */
<span class="nc" id="L821">        public HasCardReadRight(Card card) {</span>
<span class="nc" id="L822">            this.card = card;</span>
<span class="nc" id="L823">        }</span>

        /**
         * Create a has read access statement
         *
         * @param cardContent a card content
         */
<span class="nc" id="L830">        public HasCardReadRight(CardContent cardContent) {</span>
<span class="nc" id="L831">            this.card = cardContent.getCard();</span>
<span class="nc" id="L832">        }</span>

        @Override
        protected boolean internalEval(RequestManager requestManager,
            SecurityManager securityManager) {
<span class="nc" id="L837">            return securityManager.hasReadAccess(card);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L842">            return &quot;HasCardReadRight(&quot; + card + &quot;)&quot;;</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L847">            int hash = 3;</span>
<span class="nc" id="L848">            hash = 71 * hash + Objects.hashCode(this.card);</span>
<span class="nc" id="L849">            return hash;</span>
        }

        @Override
        public boolean equals(Object obj) {
<span class="nc bnc" id="L854" title="All 2 branches missed.">            if (this == obj) {</span>
<span class="nc" id="L855">                return true;</span>
            }
<span class="nc bnc" id="L857" title="All 2 branches missed.">            if (obj == null) {</span>
<span class="nc" id="L858">                return false;</span>
            }
<span class="nc bnc" id="L860" title="All 2 branches missed.">            if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L861">                return false;</span>
            }
<span class="nc" id="L863">            final HasCardReadRight other = (HasCardReadRight) obj;</span>
<span class="nc bnc" id="L864" title="All 2 branches missed.">            if (!Objects.equals(this.card, other.card)) {</span>
<span class="nc" id="L865">                return false;</span>
            }
<span class="nc" id="L867">            return true;</span>
        }
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>